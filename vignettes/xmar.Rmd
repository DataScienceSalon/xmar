---
title: "Societal Institutions | Opinions and Behaviors: Marriage"
author: "John James jjames@datasciencesalon.org"
date: '`r format(Sys.time(), "%d %B, %Y")`'
output:
  rmdformats::readthedown:
    highlight: kate
    css: rmdStyles.css
bibliography: library.bib
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


```{r knitr_init, echo=FALSE, cache=FALSE, warning=FALSE, message=FALSE}
options(knitr.table.format = "html")
options(max.print="75", scipen=999, width = 800)
knitr::opts_chunk$set(echo=FALSE,
	             cache=FALSE,
               prompt=FALSE,
               tidy=TRUE,
               root.dir = "..",
               fig.height = 8,
               fig.width = 20,
               comment=NA,
               message=FALSE,
               warning=FALSE)
knitr::opts_knit$set(width=100, figr.prefix = T, figr.link = T)
knitr::knit_hooks$set(inline = function(x) {
  prettyNum(x, big.mark=",")
})
```

```{r loadData, cache=TRUE}
load(file = "../data/GSS.Rdata")
```

```{r preprocess, cache=TRUE}
xmar <- preprocess(GSS)
```

```{r eda, cache=TRUE}
eda <- univariate(xmar)
```

# Abstract
# Introduction
## Background Information

## Research Questions
This observational study examines the nature and evolution of opinion with respect to (w.r.t.) extra-marital conduct since the start of the millennium via three research questions.

**Research Question 1:**  To what degree have opinions changed since the year 2000 by age group?    
* Dependent Variable: Opinion w.r.t. extra-marital conduct    
* Grouping Variable: Years prior to and since 2000 and Age group  

**Research Question 2:**  To what degree have opinions changed since the year 2000 by gender?
* Dependent Variable: Opinion w.r.t. extra-marital conduct  
* Grouping Variable: Years prior to and since 2000 and gender   

**Research Question 3:** To what degree have opinions changed since the year 2000 by age group and gender?  
* Dependent Variable: Opinion w.r.t. extra-marital conduct
* Grouping Variable: Years prior to and since 2000, age group and gender

## Document Organization
The **methods** section describes the data, the sampling techniques, data preprocessing, and introduces the methods, descriptive and inferential techniques used in the analyses. Hypotheses are offered, analyzed and tested in the **results** section, and the **discussion** section describes the significance of the findings vis-a-vis currently available research. Lastly, the **conclusion** synthesizes the key points.

# Methods
## Data 
The General Social Survey (GSS), a project of the NORC at the University of Chicago, provided the data upon which this report is based. Formerly known as the National Opinion Research Center, "NORC at the University of Chicago is an objective non-partisan research institution that delivers reliable data and rigorous analysis to guide critical programmatic, business, and policy decisions" [@NORC]. Principally funded by the National Science Foundation, the GSS has been monitoring evolution, complexity opinions, behaviors, and attributes of American society since 1972. Targeting the adult population, age 18 and over in the United, the data covers a diverse range of issues including national spending priorities, marijuana use, crime and punishment, race relations, quality of life, confidence in institutions, and sexual behavior.

### Data Sampling Strategy
The GSS employed a multi-stage area full probability sampling strategy. 

At the first stage, NORC employed the Standard Metropolitan Statistical Areas (SMSAs) or non-metropolitan counties selected in NORC's Master Sample, as the Primary Sampling Unit (PSU). These were further subdvided into three categories. Category 1, representing 56% of the US population, comprised of the nations largest metropolitan areas or Consolidated Statistical Areas (CSAs) with a population of at least 1,543,728 (0.5 percent of the 2010 Census U.S. population). The second category, covering 35% of the US population, included Core Based Statistical Areas and CSAs with at least 8 tracts that are predominantly street-style addresses.  The third category spanned 9% of the US population and consisted of small counties with at most 8 tracts. Minimum size for tracts were defined as 300 respondents.

Similarly, the second stage sampling was conducted in three categories. Category 1 comprised 216 type A tracts (city addresses) and 8 block-groups within type B (rural) tracts. Category 2, consisted of 8 segments per first-stage selection resulted in 480 segments in the 2010 National Sample Design, but GSS used only 120 of them. For category 3 first-stage selections, the 2010 National Sample Design only selected 5 segments per first-stage selection, but GSS used 4 and one half of them for a total of 56 segments.  

The sampling strategy employed by GSS was designed to give each household an equal probability of being included in the sample. For each household selected, sampling procedures were undertaken to ensure that each individual in that household had an equal probability of being interviewed. 

### Data Sampling Bias
The GSS samples closely resemble distributions reported in the Census and other authoritative sources. However, survey non-response, sampling variation, and various other factors have introduced potential sources of bias and resulted in variance from Census distributions on some variables. For instance all full-probability samples under-represent males and block quota samples under-represented men in full-time employment. Weights were designed (and should be employed when using GSS 2004 or later), to assure proper representation of non-response sub-samples, and other factors. For a full discussion of distributional variation due to non-response, one should refer to the GSS Methodological Reports in the help and resources section at https://gssdataexplorer.norc.org/,

This full probability design was acknowledged by the National Science Foundation to be superior to simple random sampling, and **generalizable** to the population of adult citizens in America.  Consisting of over 60,000 individual responses, spanning over 40 years, the GSS data remains one of the nations treasures, providing data for inference about American society to researchers, academics, students, politicians, and opinion makers.  Yet, as respondents were randomly selected (not assigned), one is careful to limit inferences to **association, and not causation.**  That said, the extent to which results of a research question can be generalized to the population will require that the inference conditions are met, specifically the proportion success/failure condition. As such, the question of "generalizeability" will need to be re-addressed independently for each research question.

### Data Variables
The following table lists the variables extracted from the GSS data.

`r kfigr::figr(label = "variableTbl", prefix = TRUE, link = TRUE, type="Table")`: GSS Variables
```{r variableTbl, echo = F, message = FALSE, warning=FALSE}
variables <- read.csv("../data/variables.csv")
knitr::kable(variables) %>%  
  kableExtra::kable_styling(bootstrap_options = c("hover", "condensed", "responsive"), full_width = F, position = "center")
```

### Data Preprocessing
The GSS variables were extracted for years 1972 thru 2016 and the following variables were created.

**Years**: Two factor variable  
* Prior to 2000: Years from beginning of study through 1999 inclusive  
* Since 2000: Years from 2000 through 2016  

**Age Group**: Four factor variable  
* 18-24  
* 25-44  
* 45-64  
* 65+  

**Opinion**: Two factor variable:  
* Conservative: Always wrong and almost always wrong  
* Liberal: Sometimes wrong and not wrong at all  

**GenderAge**: Eight factor variable:
* Combines gender and age group into a single 8 factor variable.

Responses with "NAs", "Don't Know", and other non-response values for the GSS variables in scope, were filtered from the data set. 

## Data Analysis
The data analysis outlined in the results section begins with a univariate exploratory data analysis of each study variable. Having established the univariate descriptive and inferential statistics, each research question is explored using the following hypothesis testing approach:  
1. State Hypotheses  
2. Check Parametric Inference Conditions  
3. Select appropriate statistical method / test statistic  
4. Compute the p-value, the probability of observing the data given the null hypothesis  
5. Interpret and report results.   

### State Hypotheses
Two types of hypothesis tests were conducted during this analysis; tests for independence (association) and tests for differences in two proportions.  

Hypothesis tests for independence (or association) of categorical variables take the form:   
$H_0$ The two categorical variables are independent, e.g. expected counts $E$ and observed counts $O$ are equal.  
$H_a$ The two categorical variables are **not** independent, e.g. expected counts $E$ and observed counts $O$ are **not** equal.  
Tests for difference in two-proportions take the following form:  
$H_0$ Proportions are equal, e.g. $p_1 = p_2$
$H_a$ Proportions are not equal, e.g. $p_1 \neq p_2$

### Inference Conditions
Statistical inferences were derived from parametric statistics and the central limit theoreom, whereby the former assumes that sample data comes from a population distribution with a fixed set of parameters, and the later assumes that the distribution is normal and that the parameters are $N(\mu, \sigma^2)$, where $\mu$ is the population proportion parameter $\hat{p}$ and $\sigma^2$ is the variation of of the population proportion parameter. We can assume that the sample comes from a normally distributed population if:  
1. **Independence:** The sample observations must be independent. Since all samples were obtained through random sampling, independence was assumed for all statistical tests.  
2. **Success/Failure:** There are at least 10 successes and 10 failures for dichotomous categorical variables.  
3. **Sample Size:** The sample size must be less than 10% of the population, if drawn without replacement. According to 2010 census, the population of adults ag 18 and older exceeded 200 million. Since the GSS data contains less than 2 million observations, this sample size requirement was assumed for all statistical tests.

For tests of independence, the following two additional criteria must be met.
1. **Expected Values:** For multiple groups or for categorical variables with multiple levels (>2), the *expected* counts must be greater than five for each variable and level.  
2. **Degrees of Freedom:** Degrees of freedom for independence tests must be greater than 2.

**Notes regarding inference conditions:**
IndependeSince each sample was subject to a random sampling strategy, one can assume for the purposes of this analysis, that the independence condition is met. The other conditions depend upon sample size and will be assessed independently.

The exploratory univariate data analysis examines each of the study variables.  To ensure that the observed sample proportions were within a 5% margin of error of the actual population proportion, minimum required sample sizes were computed for each variable at each level. The minimum sample size $N_{min}$ for level $l$ of a categorical variable was computed as follows:

$$N_{min} = \frac{p_l(1-p_l)}{(\frac{me}{z^*})^2}$$
where
$p_l$ is the sample proportion for the categorical variable at level $l$
$me$ is the margin of error
$z^*$ is the critical value on the z-distribution for the designated margin of error

### Statistical Methods
Three types of statistical methods were used to evaluate the hypotheses statements:   
1. Chi-square test of independence for evaluating the association between categorical variables.   
2. Two-proportion z-tests for hypotheses w.r.t. the difference in two proportions.
3. Two-proportion z-tests for confidence intervals w.r.t. the difference in two proportions.

`r kfigr::figr(label = "techniques", prefix = TRUE, link = TRUE, type="Table")` summarizes the test statistical methods and techniques used by research question.

`r kfigr::figr(label = "techniques", prefix = TRUE, link = TRUE, type="Table")`: Statistical methods and techniques
```{r techniques, echo = F, message = FALSE, warning=FALSE}
techniques <- read.csv("../data/techniques.csv")
knitr::kable(techniques) %>%  
  kableExtra::kable_styling(bootstrap_options = c("hover", "condensed", "responsive"), full_width = F, position = "center")
```

#### Chi-square test of independence  
To evaluate the association between opinions, behaviors and demographic variables, Pearson’s chi-square $X^2$ test of independence was employed to compute the probability of observing differences in proportions as extreme as the differences observed, assuming the null hypothesis that *observed* counts $O$, and *expected* counts $E$ are equal. The *expected* counts are computed as follows:

$E_{(i,j)} = \frac{0T_i * 0T_j}{0T$
where:  
$E_{(i,j)}$ is a contingency table of expected counts with rows $i$ and columns $j$.    
$0T_i$ is the total for row $i$ from the **observed** contingency table.  
$0T_j$ is the total for column $j$ from the **observed** contingency table.  
$0T$ is total counts for the **observed** contingency table.  

Given the observed and expected counts, the $X^2$ test statistic is the normalized sum of squared deviations between observed and expected counts and is computed as follows:
$$X^2 = \displaystyle\sum_{i=1}^{r} \displaystyle\sum_{j=1}^{c} \frac{(O_{i,j} - E_{i,j})^2}{E_{i,j}}$$
where:  
  $X^2 = $ Pearson's cumulative test statistic.  
  $O_{i,j} = $ the frequency or count from row $i$ and column $j$ of the *observed* contingency table
  $E_{i,j} = $ the frequency or count from row $i$ and column $j$ of the *expected* contingency table
  $r = $ the number of rows in the observed (and expected) contingency tables
  $c = $ the number of columns in the observed (and expected) contingency tables

The chi-squared statistic was used to calculate a p-value by comparing the value of the statistic to a *chi-squared* distribution with $df$ degrees of freedom, where $df = (r-1) * (c-1)$. The selected level of confidence for all statistical tests was 95% ($\alpha = 0.05$). If the p-value was less than or equal to $alpha$, the null hypothesis was rejected.  Otherwise, the null hypothesis was not rejected.

#### Two proportion z-test for hypothesis tests 
To evaluate hypotheses w.r.t. the difference in two proportions, z-tests were conducted using the pooled proportions for the standard error calculation. Pooled proportions, $\hat{p}$, were calculated as follows:

$$\hat{p} = \frac{\hat{p_1}n_1 + \hat{p_2}n_2}{n_1 + n_2}$$  
where:
$n1$ is the number of samples in sample 1 
$n2$ is the number of samples in sample 2 
$p1$ is the the proportion of interest from sample 1
$p2$ is the the proportion of interest from sample 2

Given the pooled proportion, the *pooled* standard error, $SE_{pooled}$, for the difference in proportions was calculated as follows:
$$SE_{pooled} = \sqrt{\frac{\hat{p}(1-\hat{p})}{n_1} + \frac{\hat{p}(1-\hat{p})}{n_2}}$$  
where:
$\hat{p}$ is the pooled proortion calculated above
$n1$ is the number of samples in sample 1 
$n2$ is the number of samples in sample 2 

Lastly, the z-statistic under the null hypothesis of equal proportions was calculated as follows:
$$Z = \frac{(\hat{p_1} - \hat{p_2}) - 0}{SE_{pooled}}$$ 
The z-statistic was used to calculate a p-value by comparing the value of the statistic for each random variable $X$ to a *standard normal* distribution ($X \sim N(\mu = 0, \sigma^2 = 1)$. The selected level of confidence for all statistical tests was 95% ($\alpha = 0.05$). If the p-value was less than or equal to $alpha$, the null hypothesis was rejected.  Otherwise, the null hypothesis was not rejected. The p-value for a guassian distribution can be readily obtained by most statistical software packages and is computed as follows:
$$p(x;\mu, \sigma^2) = \frac{1}{\sqrt{2\pi} * \sigma} * exp(-\frac{(x-\mu)^2}{2\sigma^2})$$
where:
$x% = random variable
$\mu$ = mean of random variable x
$\sigma$ = standard deviation of a random variable x 

#### Two proportion z-test for confidence intervals
Z-tests were conducted to compute the confidence interval for the difference in two proportions. The 95% confidence intervals for the differences in two proportions were computed as follows:
$$C = (\hat{p_1} - \hat{p_2}) \pm Z^* * SE$$
where
$\hat{p_1}$ is the proportion of interest from sample 1
$\hat{p_2}$ is the proportion of interest from sample 2
$Z^*$ is the critical value for a two sided z-distribution at a 95% confidence level $\approx 1.96$

The standard error $SE$ is computed as follows:
$$SE= \sqrt{\frac{\hat{p_1}(1-\hat{p_1})}{n_1} + \frac{\hat{p_2}(1-\hat{p_2})}{n_2}}$$  
where:
$n1$ is the number of samples in sample 1 
$n2$ is the number of samples in sample 2 
$\hat{p_1}$ is the the proportion of interest from sample 1
$\hat{p_2}$ is the the proportion of interest from sample 2

#### Interpret and report results
Results were interpreted in terms of whether the null hypothesis was rejected or not as follows:  
p-value $\le \alpha$, the hypothesis is **rejected** in favor of the alternative hypothesis.  
p-value $> \alpha$, the hypothesis is **not rejected** in favor of the alternative hypothesis. 

## System and Environment
This analysis was implemented using the 64 bit version of the R Programming Language, version 3.4.1. [@TheRFoundation2015] within the R. Studio Version 1.1.330 [@RStudioTeam2016] development environment on a Windows x64-based laptop powered by an Intel Core i7-3610QM CPU @ 2.30GHz, 2301 MHz processor with 4 Cores, 8 Logical Processors, and 16.0 GB of installed memory, running the Microsoft Windows 10 Home operating system, version	10.0.14393 Build 14393. Report writing and generation packages included knitr [@Xie2013], and kfigr [@Koohafkan2015].  Data management functionality was provided by the dplyr [Wickham2015a], reshape2 [@Rcpp2016], xtable [@Dahl2016] and data table [@Dowle2016] packages. Graphics and data visualization were powered by the ggplot2 [@Wickham2016], gridExtra [@BaptisteAuguie2016], and the stargazer [@Hlavac2015] packages.  The inference [@VinhNguyen2017] statistcal package provided functionality for extracting inferential values from a fitted model.

# Results
## Exploratory Data Analysis
This section begins with the exploratory univariate data analysis of the study variables. Each study variable was examined in terms of:   
* **N**: The counts for each level of the categorical variable   
* **Minimum N**: The minimum sample size required to ensure that the sample proportion was within a 5% margin of error of the population proportion.   
* **Proportion**: The proportional responses at each level of each categorical variable    
* **Cumulative**: The cumulative proportions    
* **Confidence Interval**: The 95% confidence interval for the population proportion at each categorical level     

Barplots were rendered to graphically depict the frequencies and proportions.

### Opinion
The following table provides the descriptive statistics for the Opinion variable.

`r kfigr::figr(label = "edaOpinionStats", prefix = TRUE, link = TRUE, type="Table")`: Descriptive Statistics for Opinion Variable
```{r edaOpinionStats, echo = F, message = FALSE, warning=FALSE}
knitr::kable(eda$opinion$stats, align = c("l", rep("c", 5))) %>%  
  kableExtra::kable_styling(bootstrap_options = c("hover", "condensed", "responsive"), full_width = T, position = "center")
```

As shown in `r kfigr::figr(label = "edaOpinionStats", prefix = TRUE, link = TRUE, type="Table")` and graphically depicted in `r kfigr::figr(label = "edaOpinionPlot", prefix = TRUE, link = TRUE, type="Figure")`, there were a total of `r sum(eda$opinion$stats$N)` observations, with `r eda$opinion$stats$N[1]`, and `r eda$opinion$stats$N[2]` traditional and traditional opinions, respectively.  Since the samples were independent and the minimum required counts were met at each level, one can assume that the sample proportions were within a 5% margin of error of the population proportions. In other words, there is 95% confidence that the population proportions were within the computed confidence intervals.

```{r edaOpinionPlot, echo = F, message = FALSE, warning=FALSE}
eda$opinion$plot
```
`r kfigr::figr(label = "edaOpinionPlot", prefix = TRUE, link = TRUE, type="Figure")`: Frequency and Proportions for Opinion Variable

### Years
The following table provides the descriptive statistics for the Years variable.

`r kfigr::figr(label = "edaYearsStats", prefix = TRUE, link = TRUE, type="Table")`: Descriptive Statistics for Years Variable
```{r edaYearsStats, echo = F, message = FALSE, warning=FALSE}
knitr::kable(eda$years$stats, align = c("l", rep("c", 5))) %>%  
  kableExtra::kable_styling(bootstrap_options = c("hover", "condensed", "responsive"), full_width = T, position = "center")
```

As shown in `r kfigr::figr(label = "edaYearsStats", prefix = TRUE, link = TRUE, type="Table")` and graphically depicted in `r kfigr::figr(label = "edaYearsPlot", prefix = TRUE, link = TRUE, type="Figure")`, there were a total of `r sum(eda$years$stats$N)` observations, with `r eda$years$stats$N[1]`, and `r eda$years$stats$N[2]` observations for the years prior to 2000, and the years since 2000, respectively.  Since the samples were independent and the minimum required counts were met at each level, one can assume that the sample proportions were within a 5% margin of error of the population proportions. In other words, there is 95% confidence that the population proportions were within the computed confidence intervals.

```{r edaYearsPlot, echo = F, message = FALSE, warning=FALSE}
eda$years$plot
```
`r kfigr::figr(label = "edaYearsPlot", prefix = TRUE, link = TRUE, type="Figure")`: Frequency and Proportions for Years Variable

### Age Group
The following table provides the descriptive statistics for the Age Group variable.

`r kfigr::figr(label = "edaAgeStats", prefix = TRUE, link = TRUE, type="Table")`: Descriptive Statistics for Age Group Variable
```{r edaAgeStats, echo = F, message = FALSE, warning=FALSE}
knitr::kable(eda$age$stats, align = c("l", rep("c", 5))) %>%  
  kableExtra::kable_styling(bootstrap_options = c("hover", "condensed", "responsive"), full_width = T, position = "center")
```

As shown in `r kfigr::figr(label = "edaAgeStats", prefix = TRUE, link = TRUE, type="Table")` and graphically depicted in `r kfigr::figr(label = "edaAgePlot", prefix = TRUE, link = TRUE, type="Figure")`, there were a total of `r sum(eda$age$stats$N)` observations.  Since the samples were independent and the minimum required counts were met at each level, one can assume that the sample proportions were within a 5% margin of error of the population proportions. In other words, there is 95% confidence that the population proportions were within the computed confidence intervals.

```{r edaAgePlot, echo = F, message = FALSE, warning=FALSE}
eda$age$plot
```
`r kfigr::figr(label = "edaAgePlot", prefix = TRUE, link = TRUE, type="Figure")`: Frequency and Proportions for Age Group Variable

### Gender
The following table provides the descriptive statistics for the Gender variable.

`r kfigr::figr(label = "edaGenderStats", prefix = TRUE, link = TRUE, type="Table")`: Descriptive Statistics for Gender Variable
```{r edaGenderStats, echo = F, message = FALSE, warning=FALSE}
knitr::kable(eda$gender$stats, align = c("l", rep("c", 5))) %>%  
  kableExtra::kable_styling(bootstrap_options = c("hover", "condensed", "responsive"), full_width = T, position = "center")
```

As shown in `r kfigr::figr(label = "edaGenderStats", prefix = TRUE, link = TRUE, type="Table")` and graphically depicted in `r kfigr::figr(label = "edaGenderPlot", prefix = TRUE, link = TRUE, type="Figure")`, there were a total of `r sum(eda$gender$stats$N)` observations.  Since the samples were independent and the minimum required counts were met at each level, one can assume that the sample proportions were within a 5% margin of error of the population proportions. In other words, there is 95% confidence that the population proportions were within the computed confidence intervals.

```{r edaGenderPlot, echo = F, message = FALSE, warning=FALSE}
eda$gender$plot
```
`r kfigr::figr(label = "edaGenderPlot", prefix = TRUE, link = TRUE, type="Figure")`: Frequency and Proportions for Gender Variable

### Males by Age
The following table provides the descriptive statistics for the Male Age variable.

`r kfigr::figr(label = "edaMaleAgeStats", prefix = TRUE, link = TRUE, type="Table")`: Descriptive Statistics for Male Age Variable
```{r edaMaleAgeStats, echo = F, message = FALSE, warning=FALSE}
knitr::kable(eda$maleAge$stats, align = c("l", rep("c", 5))) %>%  
  kableExtra::kable_styling(bootstrap_options = c("hover", "condensed", "responsive"), full_width = T, position = "center")
```

As shown in `r kfigr::figr(label = "edaMaleAgeStats", prefix = TRUE, link = TRUE, type="Table")` and graphically depicted in `r kfigr::figr(label = "edaMaleAgePlot", prefix = TRUE, link = TRUE, type="Figure")`, there were a total of `r sum(eda$maleAge$stats$N)` observations.  Since the samples were independent and the minimum required counts were met at each level, one can assume that the sample proportions were within a 5% margin of error of the population proportions. In other words, there is 95% confidence that the population proportions were within the computed confidence intervals.

```{r edaMaleAgePlot, echo = F, message = FALSE, warning=FALSE}
eda$maleAge$plot
```
`r kfigr::figr(label = "edaMaleAgePlot", prefix = TRUE, link = TRUE, type="Figure")`: Frequency and Proportions for Male Age Variable

### Females by Age
The following table provides the descriptive statistics for the Female Age variable.

`r kfigr::figr(label = "edaFemaleAgeStats", prefix = TRUE, link = TRUE, type="Table")`: Descriptive Statistics for Female Age Variable
```{r edaFemaleAgeStats, echo = F, message = FALSE, warning=FALSE}
knitr::kable(eda$femaleAge$stats, align = c("l", rep("c", 5))) %>%  
  kableExtra::kable_styling(bootstrap_options = c("hover", "condensed", "responsive"), full_width = T, position = "center")
```

As shown in `r kfigr::figr(label = "edaFemaleAgeStats", prefix = TRUE, link = TRUE, type="Table")` and graphically depicted in `r kfigr::figr(label = "edaFemaleAgePlot", prefix = TRUE, link = TRUE, type="Figure")`, there were a total of `r sum(eda$femaleAge$stats$N)` observations.  Since the samples were independent and the minimum required counts were met at each level, one can assume that the sample proportions were within a 5% margin of error of the population proportions. In other words, there is 95% confidence that the population proportions were within the computed confidence intervals.

```{r edaFemaleAgePlot, echo = F, message = FALSE, warning=FALSE}
eda$femaleAge$plot
```
`r kfigr::figr(label = "edaFemaleAgePlot", prefix = TRUE, link = TRUE, type="Figure")`: Frequency and Proportions for Female Age Variable

### Summary of Exploratory Data Analysis
This exploratory data analysis revealed the frequencies and proportions of responses by the Years, Age Group, Gender, Male Age Group, and Female Age Group variables.  Since the independence and sample size requirements were met, the inferences with respect to the population parameters, are valid.   

## Research Question 1: Evolution of opinion by age group
Here, the degree to which opinions w.r.t. extra-marital conduct have changed by age group was examined via the following research question.  

> To what degree have opinions changed since the year 2000 by age group?   

### The Data
```{r ageAnalysis, echo = F, message = FALSE, warning=FALSE}
data1 <- xmar %>% filter(AgeGroup == "15-24") %>% select(Opinion, Years) 
data2 <- xmar %>% filter(AgeGroup == "25-44") %>% select(Opinion, Years) 
data3 <- xmar %>% filter(AgeGroup == "45-64") %>% select(Opinion, Years) 
data4 <- xmar %>% filter(AgeGroup == "65+") %>% select(Opinion, Years) 

age1 <- analyze(data1, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Age Group 15-24)")
age2 <- analyze(data2, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Age Group 25-44)")
age3 <- analyze(data3, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Age Group 45-64)")
age4 <- analyze(data4, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Age Group 65+)")
```

`r kfigr::figr(label = "agePlots", prefix = TRUE, link = TRUE, type="Figure")` indicates that a trend towards traditional views for the years since 2000 across all age groups, with the exception of those 65 and older.

```{r agePlots, echo = F, message = FALSE, warning=FALSE}
agePlots <- gridExtra::grid.arrange(gridExtra::arrangeGrob(age1$plots$observed, age2$plots$observed, ncol = 2),
             gridExtra::arrangeGrob(age3$plots$observed, age4$plots$observed, ncol = 2))
```
`r kfigr::figr(label = "agePlots", prefix = TRUE, link = TRUE, type="Figure")`: Observed Opinions by Age Group 

### Hypotheses
The degree to which opinions have changed by age group was examined via the following hypotheses:
$H_0$ $p_1 - p_2 = 0$  
$H_a$ $p_1 - p_2 \neq 0$  

$H_0$ $p_3 - p_4 = 0$  
$H_a$ $p_3 - p_4 \neq 0$  

$H_0$ $p_5 - p_6 = 0$  
$H_a$ $p_5 - p_6 \neq 0$  

$H_0$ $p_7 - p_8 = 0$  
$H_a$ $p_7 - p8 \neq 0$  

where:   
$p_1$ is the proportion of traditional opinion in age group 15-24 for years prior to 2000
$p_2$ is the proportion of traditional opinion in age group 15-24 for years since 2000
$p_3$ is the proportion of traditional opinion in age group 25-44 for years prior to 2000
$p_4$ is the proportion of traditional opinion in age group 25-44 for years since 2000
$p_5$ is the proportion of traditional opinion in age group 45-64 for years prior to 2000 
$p_6$ is the proportion of traditional opinion in age group 45-64 for years since 2000 
$p_7$ is the proportion of traditional opinion in age group 65+ for years prior to 2000
$p_8$ is the proportion of traditional opinion in age group 65+ for years since 2000

### Inference Conditions
The inference conditions for a two-proportion test for differences in the proportion of traditional opinion between the age groups, were examined as follows:

1. **Independence:** Each observation was subject to a stratified random sampling and so **independence** was assumed.   
2. **Success/Failure:** There must be at least 10 successes and 10 failures for dichotomous categorical variables.  As shown in `r kfigr::figr(label = "agePlots", prefix = TRUE, link = TRUE, type="Figure")`, the numbers from the sample holding traditional and non-traditional views exceed the minimum threshold of 10.
3. **Sample Size:** As indicated in section the methods section, the sample size falls well below 10% of the population.  

As such, the conditions for two-proportion z-tests were met.

### Test Results
#### Age Group 15-24
`r age1$tests$difference$stmt$type` 

As indicated in `r kfigr::figr(label = "age1ZTest", prefix = TRUE, link = TRUE, type="Table")`,  `r age1$tests$difference$stmt$detail`

`r kfigr::figr(label = "age1ZTest", prefix = TRUE, link = TRUE, type="Table")`: Two-proportion z-test of opinion by years for age group 15-24
```{r age1ZTest, echo = F, results='html'}
knitr::kable(age1$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")
``` 

`r age1$tests$difference$stmt$conclude`

#### Age Group 25-44
`r age2$tests$difference$stmt$type` 

As indicated in `r kfigr::figr(label = "age2ZTest", prefix = TRUE, link = TRUE, type="Table")`,  `r age2$tests$difference$stmt$detail`

`r kfigr::figr(label = "age2ZTest", prefix = TRUE, link = TRUE, type="Table")`: Two-proportion z-test of opinion by years for age group 25-44
```{r age2ZTest, echo = F, results='html'}
knitr::kable(age2$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")
``` 

`r age2$tests$difference$stmt$conclude`

#### Age Group 45-64
`r age3$tests$difference$stmt$type` 

As indicated in `r kfigr::figr(label = "age3ZTest", prefix = TRUE, link = TRUE, type="Table")`,  `r age3$tests$difference$stmt$detail`

`r kfigr::figr(label = "age3ZTest", prefix = TRUE, link = TRUE, type="Table")`: Two-proportion z-test of opinion by years for age group 45-64
```{r age3ZTest, echo = F, results='html'}
knitr::kable(age3$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")
``` 

`r age3$tests$difference$stmt$conclude`

#### Age Group 65+
`r age4$tests$difference$stmt$type` 

As indicated in `r kfigr::figr(label = "age4ZTest", prefix = TRUE, link = TRUE, type="Table")`,  `r age4$tests$difference$stmt$detail`

`r kfigr::figr(label = "age4ZTest", prefix = TRUE, link = TRUE, type="Table")`: Two-proportion z-test of opinion by years for age group 65+
```{r age4ZTest, echo = F, results='html'}
knitr::kable(age4$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")
``` 

`r age4$tests$difference$stmt$conclude`

## Research Question 2: Evolution of opinion by gender
Here, the degree to which opinions w.r.t. extra-marital conduct have changed by gender was examined via the following research question.  

> To what degree have opinions changed since the year 2000 by gender?   

### The Data
```{r genderAnalysis, echo = F, messgender = FALSE, warning=FALSE}
data1 <- xmar %>% filter(Gender == "Male") %>% select(Opinion, Years) 
data2 <- xmar %>% filter(Gender == "Female") %>% select(Opinion, Years) 

gender1 <- analyze(data1, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Male)")
gender2 <- analyze(data2, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Female)")
```

`r kfigr::figr(label = "genderPlots", prefix = TRUE, link = TRUE, type="Figure")` indicates that a trend towards traditional views for the years since 2000 for both genders.

```{r genderPlots, echo = F, messgender = FALSE, warning=FALSE}
genderPlots <- gridExtra::grid.arrange(gridExtra::arrangeGrob(gender1$plots$observed, gender2$plots$observed, ncol = 2))
```
`r kfigr::figr(label = "genderPlots", prefix = TRUE, link = TRUE, type="Figure")`: Observed Opinions by gender  

### Hypotheses
The degree to which opinions have changed by gender was examined via the following hypotheses:
$H_0$ $p_1 - p_2 = 0$  
$H_a$ $p_1 - p_2 \neq 0$  

$H_0$ $p_3 - p_4 = 0$  
$H_a$ $p_3 - p_4 \neq 0$  

where:   
$p_1$ is the proportion of traditional opinion among males for years prior to 2000
$p_2$ is the proportion of traditional opinion among males for years since 2000
$p_3$ is the proportion of traditional opinion among females for years prior to 2000
$p_4$ is the proportion of traditional opinion among females for years since 2000

### Inference Conditions
The inference conditions for a two-proportion test for differences in the proportion of traditional opinion between the age groups, were examined as follows:

1. **Independence:** Each observation was subject to a stratified random sampling and so **independence** was assumed.   
2. **Success/Failure:** There must be at least 10 successes and 10 failures for dichotomous categorical variables.  As shown in `r kfigr::figr(label = "genderPlots", prefix = TRUE, link = TRUE, type="Figure")`, the numbers from the sample holding traditional and non-traditional views exceed the minimum threshold of 10.
3. **Sample Size:** As indicated in section the methods section, the sample size falls well below 10% of the population.  

As such, the conditions for two-proportion z-tests were met.

### Test Results
#### Male Population
`r gender1$tests$difference$stmt$type` 

As indicated in `r kfigr::figr(label = "gender1ZTest", prefix = TRUE, link = TRUE, type="Table")`,  `r gender1$tests$difference$stmt$detail`

`r kfigr::figr(label = "gender1ZTest", prefix = TRUE, link = TRUE, type="Table")`: Two-proportion z-test of opinion by years for male population
```{r gender1ZTest, echo = F, results='html'}
knitr::kable(gender1$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")
``` 

`r gender1$tests$difference$stmt$conclude`

#### Female Population
`r gender2$tests$difference$stmt$type` 

As indicated in `r kfigr::figr(label = "gender2ZTest", prefix = TRUE, link = TRUE, type="Table")`,  `r gender2$tests$difference$stmt$detail`

`r kfigr::figr(label = "gender2ZTest", prefix = TRUE, link = TRUE, type="Table")`: Two-proportion z-test of opinion by years for female population
```{r gender2ZTest, echo = F, results='html'}
knitr::kable(gender2$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")
``` 

`r gender2$tests$difference$stmt$conclude`





## Research Question 3: Evolution of opinion by age and gender
Here, the degree to which opinions w.r.t. extra-marital conduct have changed by age and gender was examined via the following research question.  

> To what degree have opinions changed since the year 2000 by age and gender?   

### The Data
```{r genderAgeAnalysis, echo = F, messgender = FALSE, warning=FALSE}
data1 <- xmar %>% filter(GenderAge == "Male 15-24") %>% select(Opinion, Years) 
data2 <- xmar %>% filter(GenderAge == "Male 25-44") %>% select(Opinion, Years) 
data3 <- xmar %>% filter(GenderAge == "Male 45-64") %>% select(Opinion, Years) 
data4 <- xmar %>% filter(GenderAge == "Male 65+") %>% select(Opinion, Years) 
data5 <- xmar %>% filter(GenderAge == "Female 15-24") %>% select(Opinion, Years) 
data6 <- xmar %>% filter(GenderAge == "Female 25-44") %>% select(Opinion, Years) 
data7 <- xmar %>% filter(GenderAge == "Female 45-64") %>% select(Opinion, Years) 
data8 <- xmar %>% filter(GenderAge == "Female 65+") %>% select(Opinion, Years) 

genderAge1 <- analyze(data1, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Male 15-24)")
genderAge2 <- analyze(data2, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Male 25-44)")
genderAge3 <- analyze(data3, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Male 45-64)")
genderAge4 <- analyze(data4, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Male 65+)")
genderAge5 <- analyze(data5, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Female 15-24)")
genderAge6 <- analyze(data6, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Female 25-44)")
genderAge7 <- analyze(data7, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Female 45-64)")
genderAge8 <- analyze(data8, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Female 65+)")

```

`r kfigr::figr(label = "genderAgePlots", prefix = TRUE, link = TRUE, type="Figure")` indicates that a trend towards traditional views for the years since 2000 for both genderAges.

```{r genderAgePlots, echo = F, messgenderAge = FALSE, warning=FALSE, fig.height = 20}
genderAgePlots <- 
gridExtra::grid.arrange(gridExtra::arrangeGrob(genderAge1$plots$observed, genderAge2$plots$observed, ncol = 2),
                        gridExtra::arrangeGrob(genderAge3$plots$observed, genderAge4$plots$observed, ncol = 2),
                        gridExtra::arrangeGrob(genderAge5$plots$observed, genderAge6$plots$observed, ncol = 2),
                        gridExtra::arrangeGrob(genderAge7$plots$observed, genderAge8$plots$observed, ncol = 2),
                        nrow = 4)
```
`r kfigr::figr(label = "genderAgePlots", prefix = TRUE, link = TRUE, type="Figure")`: Observed Opinions by gender and age group  

### Hypotheses
The degree to which opinions have changed by gender and age group was examined via the following hypotheses:
$H_0$ $p_1 - p_2 = 0$  
$H_a$ $p_1 - p_2 \neq 0$  

$H_0$ $p_3 - p_4 = 0$  
$H_a$ $p_3 - p_4 \neq 0$  

$H_0$ $p_5 - p_6 = 0$  
$H_a$ $p_5 - p_6 \neq 0$  

$H_0$ $p_7 - p_8 = 0$  
$H_a$ $p_7 - p_8 \neq 0$

$H_0$ $p_9 - p_{10} = 0$  
$H_a$ $p_9 - p_{10} \neq 0$  

$H_0$ $p_{11} - p_{12} = 0$  
$H_a$ $p_{11} - p_{12} \neq 0$  

$H_0$ $p_{13} - p_{14} = 0$  
$H_a$ $p_{13} - p_{14} \neq 0$  

$H_0$ $p_{15} - p_{16} = 0$  
$H_a$ $p_{15} - p_{16} \neq 0$

where:   
$p_1$ is the proportion of traditional opinion among males age 15-24 for years prior to 2000
$p_2$ is the proportion of traditional opinion among males age 15-24 for years since 2000
$p_3$ is the proportion of traditional opinion among males age 25-44 for years prior to 2000
$p_4$ is the proportion of traditional opinion among males age 25-44 for years since 2000
$p_5$ is the proportion of traditional opinion among males age 45-64 for years prior to 2000
$p_6$ is the proportion of traditional opinion among males age 45-64 for years since 2000
$p_7$ is the proportion of traditional opinion among males age 65+ for years prior to 2000
$p_8$ is the proportion of traditional opinion among males age 65+ for years since 2000


$p_9$ is the proportion of traditional opinion among females age 15-24 for years prior to 2000
$p_{10}$ is the proportion of traditional opinion among females age 15-24 for years since 2000
$p_{11}$ is the proportion of traditional opinion among females age 25-44 for years prior to 2000
$p_{12}$ is the proportion of traditional opinion among females age 25-44 for years since 2000
$p_{13}$ is the proportion of traditional opinion among females age 45-64 for years prior to 2000
$p_{14}$ is the proportion of traditional opinion among females age 45-64 for years since 2000
$p_{15}$ is the proportion of traditional opinion among females age 65+ for years prior to 2000
$p_{16}$ is the proportion of traditional opinion among females age 65+ for years since 2000


### Inference Conditions
The inference conditions for a two-proportion test for differences in the proportion of traditional opinion between the genders and age groups, were examined as follows:

1. **Independence:** Each observation was subject to a stratified random sampling and so **independence** was assumed.   
2. **Success/Failure:** There must be at least 10 successes and 10 failures for dichotomous categorical variables.  As shown in `r kfigr::figr(label = "genderAgePlots", prefix = TRUE, link = TRUE, type="Figure")`, the numbers from the sample holding traditional and non-traditional views exceed the minimum threshold of 10.
3. **Sample Size:** As indicated in section the methods section, the sample size falls well below 10% of the population.  

As such, the conditions for two-proportion z-tests were met.

### Test Results
#### Male Population Age 15-24
`r genderAge1$tests$difference$stmt$type` 

As indicated in `r kfigr::figr(label = "genderAge1ZTest", prefix = TRUE, link = TRUE, type="Table")`,  `r genderAge1$tests$difference$stmt$detail`

`r kfigr::figr(label = "genderAge1ZTest", prefix = TRUE, link = TRUE, type="Table")`: Two-proportion z-test of opinion by years for male population age 15-24
```{r genderAge1ZTest, echo = F, results='html'}
knitr::kable(genderAge1$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")
``` 

`r genderAge1$tests$difference$stmt$conclude`

#### Male Population Age 25-44
`r genderAge2$tests$difference$stmt$type` 

As indicated in `r kfigr::figr(label = "genderAge2ZTest", prefix = TRUE, link = TRUE, type="Table")`,  `r genderAge2$tests$difference$stmt$detail`

`r kfigr::figr(label = "genderAge2ZTest", prefix = TRUE, link = TRUE, type="Table")`: Two-proportion z-test of opinion by years for male population age 25-44
```{r genderAge2ZTest, echo = F, results='html'}
knitr::kable(genderAge2$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")
``` 

`r genderAge2$tests$difference$stmt$conclude`

#### Male Population Age 45-64
`r genderAge3$tests$difference$stmt$type` 

As indicated in `r kfigr::figr(label = "genderAge3ZTest", prefix = TRUE, link = TRUE, type="Table")`,  `r genderAge3$tests$difference$stmt$detail`

`r kfigr::figr(label = "genderAge3ZTest", prefix = TRUE, link = TRUE, type="Table")`: Two-proportion z-test of opinion by years for male population age 45-64
```{r genderAge3ZTest, echo = F, results='html'}
knitr::kable(genderAge3$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")
``` 

`r genderAge3$tests$difference$stmt$conclude`

#### Male Population Age 65+
`r genderAge4$tests$difference$stmt$type` 

As indicated in `r kfigr::figr(label = "genderAge4ZTest", prefix = TRUE, link = TRUE, type="Table")`,  `r genderAge4$tests$difference$stmt$detail`

`r kfigr::figr(label = "genderAge4ZTest", prefix = TRUE, link = TRUE, type="Table")`: Two-proportion z-test of opinion by years for male population age 65+
```{r genderAge4ZTest, echo = F, results='html'}
knitr::kable(genderAge4$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")
``` 

`r genderAge4$tests$difference$stmt$conclude`


#### Female Population Age 15-24
`r genderAge5$tests$difference$stmt$type` 

As indicated in `r kfigr::figr(label = "genderAge5ZTest", prefix = TRUE, link = TRUE, type="Table")`,  `r genderAge5$tests$difference$stmt$detail`

`r kfigr::figr(label = "genderAge5ZTest", prefix = TRUE, link = TRUE, type="Table")`: Two-proportion z-test of opinion by years for female population age 15-24
```{r genderAge5ZTest, echo = F, results='html'}
knitr::kable(genderAge5$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")
``` 

`r genderAge5$tests$difference$stmt$conclude`

#### Female Population Age 25-44
`r genderAge6$tests$difference$stmt$type` 

As indicated in `r kfigr::figr(label = "genderAge6ZTest", prefix = TRUE, link = TRUE, type="Table")`,  `r genderAge6$tests$difference$stmt$detail`

`r kfigr::figr(label = "genderAge6ZTest", prefix = TRUE, link = TRUE, type="Table")`: Two-proportion z-test of opinion by years for female population age 25-44
```{r genderAge6ZTest, echo = F, results='html'}
knitr::kable(genderAge6$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")
``` 

`r genderAge6$tests$difference$stmt$conclude`

#### Female Population Age 45-64
`r genderAge7$tests$difference$stmt$type` 

As indicated in `r kfigr::figr(label = "genderAge7ZTest", prefix = TRUE, link = TRUE, type="Table")`,  `r genderAge7$tests$difference$stmt$detail`

`r kfigr::figr(label = "genderAge7ZTest", prefix = TRUE, link = TRUE, type="Table")`: Two-proportion z-test of opinion by years for female population age 45-64
```{r genderAge7ZTest, echo = F, results='html'}
knitr::kable(genderAge7$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")
``` 

`r genderAge7$tests$difference$stmt$conclude`

#### Female Population Age 65+
`r genderAge8$tests$difference$stmt$type` 

As indicated in `r kfigr::figr(label = "genderAge8ZTest", prefix = TRUE, link = TRUE, type="Table")`,  `r genderAge8$tests$difference$stmt$detail`

`r kfigr::figr(label = "genderAge8ZTest", prefix = TRUE, link = TRUE, type="Table")`: Two-proportion z-test of opinion by years for female population age 65+
```{r genderAge8ZTest, echo = F, results='html'}
knitr::kable(genderAge8$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")
``` 

`r genderAge8$tests$difference$stmt$conclude`


# Appendix
## Source Code
### Preprocess Data
This function extracts filters non-responses and creates the study variables.
```{r a-preprocess, code=readLines('../R/preprocess.R')[11:47], echo=TRUE, eval=FALSE}
```

### Exploratory Data Analysis
The following function performs the exploratory univariate data analysis on the study variables.
```{r a-eda, code=readLines('../R/univariate.R')[11:104], echo=TRUE, eval=FALSE}
```

### Exploratory Data Analysis
The following function performs the exploratory univariate data analysis on the study variables.
```{r a-eda, code=readLines('../R/univariate.R')[11:104], echo=TRUE, eval=FALSE}
```



# References
