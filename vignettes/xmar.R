## ----knitr_init, echo=FALSE, cache=FALSE, warning=FALSE, message=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
options(knitr.table.format = "html")
options(max.print="75", scipen=999, width = 800)
knitr::opts_chunk$set(echo=FALSE,
	             cache=FALSE,
               prompt=FALSE,
               tidy=TRUE,
               root.dir = "..",
               fig.height = 8,
               fig.width = 20,
               comment=NA,
               message=FALSE,
               warning=FALSE)
knitr::opts_knit$set(width=100, figr.prefix = T, figr.link = T)
knitr::knit_hooks$set(inline = function(x) {
  prettyNum(x, big.mark=",")
})

## ----variableTbl, echo = F, message = FALSE, warning=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
variables <- read.csv("../data/variables.csv")
knitr::kable(variables) %>%  
  kableExtra::kable_styling(bootstrap_options = c("hover", "condensed", "responsive"), full_width = F, position = "center")

## ----techniques, echo = F, message = FALSE, warning=FALSE---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
techniques <- read.csv("../data/techniques.csv")
knitr::kable(techniques) %>%  
  kableExtra::kable_styling(bootstrap_options = c("hover", "condensed", "responsive"), full_width = F, position = "center") %>%
  kableExtra::group_rows("Research Questions 1-3", 1,1) %>%
  kableExtra::group_rows("Research Questions 4-6", 2,4) 

## ----edaOpinionStats, echo = F, message = FALSE, warning=FALSE----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(eda$opinion$stats, align = c("l", rep("c", 5))) %>%  
  kableExtra::kable_styling(bootstrap_options = c("hover", "condensed", "responsive"), full_width = T, position = "center")

## ----edaOpinionPlot, echo = F, message = FALSE, warning=FALSE-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
eda$opinion$plot

## ----edaYearsStats, echo = F, message = FALSE, warning=FALSE------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(eda$years$stats, align = c("l", rep("c", 5))) %>%  
  kableExtra::kable_styling(bootstrap_options = c("hover", "condensed", "responsive"), full_width = T, position = "center")

## ----edaYearsPlot, echo = F, message = FALSE, warning=FALSE-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
eda$years$plot

## ----edaAgeStats, echo = F, message = FALSE, warning=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(eda$age$stats, align = c("l", rep("c", 5))) %>%  
  kableExtra::kable_styling(bootstrap_options = c("hover", "condensed", "responsive"), full_width = T, position = "center")

## ----edaAgePlot, echo = F, message = FALSE, warning=FALSE---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
eda$age$plot

## ----edaGenderStats, echo = F, message = FALSE, warning=FALSE-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(eda$gender$stats, align = c("l", rep("c", 5))) %>%  
  kableExtra::kable_styling(bootstrap_options = c("hover", "condensed", "responsive"), full_width = T, position = "center")

## ----edaGenderPlot, echo = F, message = FALSE, warning=FALSE------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
eda$gender$plot

## ----edaMaleAgeStats, echo = F, message = FALSE, warning=FALSE----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(eda$maleAge$stats, align = c("l", rep("c", 5))) %>%  
  kableExtra::kable_styling(bootstrap_options = c("hover", "condensed", "responsive"), full_width = T, position = "center")

## ----edaMaleAgePlot, echo = F, message = FALSE, warning=FALSE-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
eda$maleAge$plot

## ----edaFemaleAgeStats, echo = F, message = FALSE, warning=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(eda$femaleAge$stats, align = c("l", rep("c", 5))) %>%  
  kableExtra::kable_styling(bootstrap_options = c("hover", "condensed", "responsive"), full_width = T, position = "center")

## ----edaFemaleAgePlot, echo = F, message = FALSE, warning=FALSE---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
eda$femaleAge$plot

## ----a-preprocess, code=readLines('../R/preprocess.R')[11:49], echo=TRUE, eval=FALSE------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#  preprocess <- function(GSS) {
#  
#    # Create study variables
#    xmar <- GSS %>%
#      dplyr::mutate(
#        Years = ifelse(YEAR < 2000, "Prior to 2000", "Since 2000"),
#        AgeGroup = ifelse(AGE < 25, "15-24",
#                          ifelse(AGE < 45, "25-44",
#                                 ifelse(AGE < 65, "45-64",
#                                        ifelse(AGE < 98, "65+", "NA")))),
#        Gender = ifelse(SEX == 1, "Male",
#                        ifelse(SEX == 2, "Female", "NA")),
#        GenderAge = paste(Gender, AgeGroup),
#        Opinion = ifelse(XMARSEX %in% c(1,2), "Conservative",
#                          ifelse(XMARSEX  %in%  c(3,4), "Liberal", "NA"))) %>%
#      dplyr::select(Years, AgeGroup, Gender, GenderAge, Opinion)
#  
#    # Filter NA values
#    xmar <- xmar %>% filter(AgeGroup != "NA")
#    xmar <- xmar %>% filter(Gender != "NA")
#    xmar <- xmar %>% filter(Opinion != "NA")
#  
#  
#    # Create factor levels
#    xmar$Years <- factor(xmar$Years, levels = c("Prior to 2000", "Since 2000"))
#    xmar$AgeGroup <- factor(xmar$AgeGroup,
#                            levels = c("15-24", "25-44", "45-64", "65+"))
#    xmar$Gender <- factor(xmar$Gender, levels = c("Male", "Female"))
#    xmar$GenderAge <- factor(xmar$GenderAge,
#                             levels = c("Male 15-24", "Male 25-44", "Male 45-64",
#                                        "Male 65+",
#                                        "Female 15-24", "Female 25-44", "Female 45-64",
#                                        "Female 65+"))
#    xmar$Opinion <- factor(xmar$Opinion, levels = c("Conservative", "Liberal"))
#  
#    return(xmar)
#  }
#  NA
#  NA

## ----a-eda, code=readLines('../R/univariate.R')[11:105], echo=TRUE, eval=FALSE------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#  univariate <- function(xmar) {
#  
#    analyze <- function(data, var) {
#  
#      me <- 0.05
#      alpha <- 0.05
#      z <- (1-alpha/2)
#  
#      stats <- data %>%
#        mutate(Level = data[,1],
#               `Minimum N` = round(p * (1-p) / (me / qnorm(z))^2, 0),
#               N = N,
#               Proportion = round(p, 2),
#               Cumulative = round(cumsum(Proportion), 2),
#               `Confidence Interval (95%)` =
#                 paste0("[",
#                        round(Proportion -
#                                (qnorm(z) *
#                                   sqrt(Proportion * (1 - Proportion) / N)),3),
#                        ", ",
#                        round(Proportion +
#                                (qnorm(z) *
#                                   sqrt(Proportion * (1 - Proportion) / N)),3),
#                        "]"),
#               pos = N / 2)
#  
#      barplot <- ggplot2::ggplot(data = stats,
#                                 ggplot2::aes(x = Level, y = N, fill = Level)) +
#        ggplot2::geom_bar(stat='identity') + ggplot2::theme_minimal(base_size = 24) +
#        ggplot2::geom_text(
#          data = stats,
#          ggplot2::aes(x = Level, y = pos,
#                       label = paste0(N, " (",round(Proportion * 100, 0),"%)")),
#          colour="black", family="Tahoma", size = 8) +
#        ggplot2::theme(text = ggplot2::element_text(family="Open Sans"),
#                       axis.title.x = ggplot2::element_blank(),
#                       axis.ticks.x = ggplot2::element_blank(),
#                       legend.position = "none") +
#        ggplot2::scale_fill_brewer(palette = 'Greens') +
#        ggplot2::ggtitle(paste('Frequency and Proportion of Responses by', var))
#  
#      stats <- stats %>% select(Level, `Minimum N`, N, Proportion, Cumulative,
#                                `Confidence Interval (95%)`)
#  
#      analysis <- list(
#        stats = stats,
#        plot = barplot
#      )
#  
#      return(analysis)
#    }
#  
#    # Format Data
#    opinion <- as.data.frame(xmar %>% select(Opinion) %>% group_by(Opinion) %>%
#                             summarize(N = n()) %>%
#                             mutate(p = N/ sum(N)), row.names = NULL)
#  
#    years <- as.data.frame(xmar %>% select(Years) %>% group_by(Years) %>%
#                             summarize(N = n()) %>%
#                             mutate(p = N/ sum(N)), row.names = NULL)
#    age <- as.data.frame(xmar %>% select(AgeGroup) %>% group_by(AgeGroup) %>%
#                           summarize(N = n()) %>%
#                           mutate(p = N/ sum(N)), row.names = NULL)
#    gender <- as.data.frame(xmar %>% select(Gender) %>% group_by(Gender) %>%
#                              summarize(N = n()) %>%
#                              mutate(p = N/ sum(N)), row.names = NULL)
#    maleAge <- as.data.frame(xmar %>% filter(Gender == "Male") %>%
#                               group_by(GenderAge) %>%
#                               summarize(N = n()) %>%
#                               mutate(p = N/ sum(N)), row.names = NULL)
#    femaleAge <- as.data.frame(xmar %>% filter(Gender == "Female") %>%
#                               group_by(GenderAge) %>%
#                               summarize(N = n()) %>%
#                               mutate(p = N/ sum(N)), row.names = NULL)
#  
#    # Conduct Analysis
#    opinion <- analyze(opinion, "Opinion")
#    years <- analyze(years, "Years")
#    age <- analyze(age, "Age Group")
#    gender <- analyze(gender, "Gender")
#    maleAge <- analyze(maleAge, "Males and Age Group")
#    femaleAge <- analyze(femaleAge, "Females and Age Group")
#  
#    # Return analysis
#    analysis <- list(
#      opinion = opinion,
#      years = years,
#      age = age,
#      gender = gender,
#      maleAge = maleAge,
#      femaleAge = femaleAge
#      )
#    return(analysis)
#  }
#  NA

