## ----knitr_init, echo=FALSE, cache=FALSE, warning=FALSE, message=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
options(knitr.table.format = "html")
options(max.print="75", scipen=999, width = 800)
knitr::opts_chunk$set(echo=FALSE,
	             cache=FALSE,
               prompt=FALSE,
               tidy=TRUE,
               root.dir = "..",
               fig.height = 8,
               fig.width = 20,
               comment=NA,
               message=FALSE,
               warning=FALSE)
knitr::opts_knit$set(width=100, figr.prefix = T, figr.link = T)
knitr::knit_hooks$set(inline = function(x) {
  prettyNum(x, big.mark=",")
})

## ----loadData, cache=TRUE-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
load(file = "../data/GSS.Rdata")

## ----preprocess, cache=TRUE---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
xmar <- preprocess(GSS)

## ----eda, cache=TRUE----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
eda <- univariate(xmar)

## ----variableTbl, echo = F, message = FALSE, warning=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
variables <- read.csv("../data/variables.csv")
knitr::kable(variables) %>%  
  kableExtra::kable_styling(bootstrap_options = c("hover", "condensed", "responsive"), full_width = F, position = "center")

## ----techniques, echo = F, message = FALSE, warning=FALSE---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
techniques <- read.csv("../data/techniques.csv")
knitr::kable(techniques) %>%  
  kableExtra::kable_styling(bootstrap_options = c("hover", "condensed", "responsive"), full_width = F, position = "center")

## ----edaOpinionStats, echo = F, message = FALSE, warning=FALSE----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(eda$opinion$stats, align = c("l", rep("c", 5))) %>%  
  kableExtra::kable_styling(bootstrap_options = c("hover", "condensed", "responsive"), full_width = T, position = "center")

## ----edaOpinionPlot, echo = F, message = FALSE, warning=FALSE-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
eda$opinion$plot

## ----edaYearsStats, echo = F, message = FALSE, warning=FALSE------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(eda$years$stats, align = c("l", rep("c", 5))) %>%  
  kableExtra::kable_styling(bootstrap_options = c("hover", "condensed", "responsive"), full_width = T, position = "center")

## ----edaYearsPlot, echo = F, message = FALSE, warning=FALSE-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
eda$years$plot

## ----edaAgeStats, echo = F, message = FALSE, warning=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(eda$age$stats, align = c("l", rep("c", 5))) %>%  
  kableExtra::kable_styling(bootstrap_options = c("hover", "condensed", "responsive"), full_width = T, position = "center")

## ----edaAgePlot, echo = F, message = FALSE, warning=FALSE---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
eda$age$plot

## ----edaGenderStats, echo = F, message = FALSE, warning=FALSE-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(eda$gender$stats, align = c("l", rep("c", 5))) %>%  
  kableExtra::kable_styling(bootstrap_options = c("hover", "condensed", "responsive"), full_width = T, position = "center")

## ----edaGenderPlot, echo = F, message = FALSE, warning=FALSE------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
eda$gender$plot

## ----edaMaleAgeStats, echo = F, message = FALSE, warning=FALSE----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(eda$maleAge$stats, align = c("l", rep("c", 5))) %>%  
  kableExtra::kable_styling(bootstrap_options = c("hover", "condensed", "responsive"), full_width = T, position = "center")

## ----edaMaleAgePlot, echo = F, message = FALSE, warning=FALSE-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
eda$maleAge$plot

## ----edaFemaleAgeStats, echo = F, message = FALSE, warning=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(eda$femaleAge$stats, align = c("l", rep("c", 5))) %>%  
  kableExtra::kable_styling(bootstrap_options = c("hover", "condensed", "responsive"), full_width = T, position = "center")

## ----edaFemaleAgePlot, echo = F, message = FALSE, warning=FALSE---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
eda$femaleAge$plot

## ----ageAnalysis, echo = F, message = FALSE, warning=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
data1 <- xmar %>% filter(AgeGroup == "15-24") %>% select(Opinion, Years) 
data2 <- xmar %>% filter(AgeGroup == "25-44") %>% select(Opinion, Years) 
data3 <- xmar %>% filter(AgeGroup == "45-64") %>% select(Opinion, Years) 
data4 <- xmar %>% filter(AgeGroup == "65+") %>% select(Opinion, Years) 

age1 <- analyze(data1, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Age Group 15-24)")
age2 <- analyze(data2, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Age Group 25-44)")
age3 <- analyze(data3, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Age Group 45-64)")
age4 <- analyze(data4, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Age Group 65+)")

## ----agePlots, echo = F, message = FALSE, warning=FALSE-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
agePlots <- gridExtra::grid.arrange(gridExtra::arrangeGrob(age1$plots$observed, age2$plots$observed, ncol = 2),
             gridExtra::arrangeGrob(age3$plots$observed, age4$plots$observed, ncol = 2))

## ----age1ZTest, echo = F, results='html'--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(age1$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")

## ----age2ZTest, echo = F, results='html'--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(age2$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")

## ----age3ZTest, echo = F, results='html'--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(age3$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")

## ----age4ZTest, echo = F, results='html'--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(age4$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")

## ----genderAnalysis, echo = F, messgender = FALSE, warning=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
data1 <- xmar %>% filter(Gender == "Male") %>% select(Opinion, Years) 
data2 <- xmar %>% filter(Gender == "Female") %>% select(Opinion, Years) 

gender1 <- analyze(data1, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Male)")
gender2 <- analyze(data2, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Female)")

## ----genderPlots, echo = F, messgender = FALSE, warning=FALSE-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
genderPlots <- gridExtra::grid.arrange(gridExtra::arrangeGrob(gender1$plots$observed, gender2$plots$observed, ncol = 2))

## ----gender1ZTest, echo = F, results='html'-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(gender1$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")

## ----gender2ZTest, echo = F, results='html'-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(gender2$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")

## ----genderAgeAnalysis, echo = F, messgender = FALSE, warning=FALSE-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
data1 <- xmar %>% filter(GenderAge == "Male 15-24") %>% select(Opinion, Years) 
data2 <- xmar %>% filter(GenderAge == "Male 25-44") %>% select(Opinion, Years) 
data3 <- xmar %>% filter(GenderAge == "Male 45-64") %>% select(Opinion, Years) 
data4 <- xmar %>% filter(GenderAge == "Male 65+") %>% select(Opinion, Years) 
data5 <- xmar %>% filter(GenderAge == "Female 15-24") %>% select(Opinion, Years) 
data6 <- xmar %>% filter(GenderAge == "Female 25-44") %>% select(Opinion, Years) 
data7 <- xmar %>% filter(GenderAge == "Female 45-64") %>% select(Opinion, Years) 
data8 <- xmar %>% filter(GenderAge == "Female 65+") %>% select(Opinion, Years) 

genderAge1 <- analyze(data1, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Male 15-24)")
genderAge2 <- analyze(data2, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Male 25-44)")
genderAge3 <- analyze(data3, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Male 45-64)")
genderAge4 <- analyze(data4, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Male 65+)")
genderAge5 <- analyze(data5, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Female 15-24)")
genderAge6 <- analyze(data6, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Female 25-44)")
genderAge7 <- analyze(data7, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Female 45-64)")
genderAge8 <- analyze(data8, y = "Opinion", x = "Years", success = "Traditional", title = "Opinions by Years (Female 65+)")


## ----genderAgePlots, echo = F, messgenderAge = FALSE, warning=FALSE-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
genderAgePlots <- 
gridExtra::grid.arrange(gridExtra::arrangeGrob(genderAge1$plots$observed, genderAge2$plots$observed, ncol = 1),
                        gridExtra::arrangeGrob(genderAge3$plots$observed, genderAge4$plots$observed, ncol = 1),
                        gridExtra::arrangeGrob(genderAge5$plots$observed, genderAge6$plots$observed, ncol = 1),
                        gridExtra::arrangeGrob(genderAge7$plots$observed, genderAge8$plots$observed, ncol = 1),
                        nrow = 4)

## ----genderAge1ZTest, echo = F, results='html'--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(genderAge1$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")

## ----genderAge2ZTest, echo = F, results='html'--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(genderAge2$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")

## ----genderAge3ZTest, echo = F, results='html'--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(genderAge3$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")

## ----genderAge4ZTest, echo = F, results='html'--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(genderAge4$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")

## ----genderAge5ZTest, echo = F, results='html'--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(genderAge5$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")

## ----genderAge6ZTest, echo = F, results='html'--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(genderAge6$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")

## ----genderAge7ZTest, echo = F, results='html'--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(genderAge7$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")

## ----genderAge8ZTest, echo = F, results='html'--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
knitr::kable(genderAge8$tests$difference$df) %>%  
  kableExtra::kable_styling(bootstrap_options = c("striped", "condensed"), full_width = T, position = "center")

## ----a-preprocess, code=readLines('../R/preprocess.R')[11:47], echo=TRUE, eval=FALSE------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#  preprocess <- function(GSS) {
#  
#    # Create study variables
#    xmar <- GSS %>%
#      dplyr::mutate(
#        Years = ifelse(YEAR < 2000, "Prior to 2000", "Since 2000"),
#        AgeGroup = ifelse(AGE < 25, "15-24",
#                          ifelse(AGE < 45, "25-44",
#                                 ifelse(AGE < 65, "45-64",
#                                        ifelse(AGE < 98, "65+", "NA")))),
#        Gender = ifelse(SEX == 1, "Male",
#                        ifelse(SEX == 2, "Female", "NA")),
#        GenderAge = paste(Gender, AgeGroup),
#        Opinion = ifelse(XMARSEX %in% c(1,2), "Traditional",
#                          ifelse(XMARSEX  %in%  c(3,4), "Non-Traditional", "NA"))) %>%
#      dplyr::select(Years, AgeGroup, Gender, GenderAge, Opinion)
#  
#    # Filter NA values
#    xmar <- xmar %>% filter(AgeGroup != "NA")
#    xmar <- xmar %>% filter(Gender != "NA")
#    xmar <- xmar %>% filter(Opinion != "NA")
#  
#  
#    # Create factor levels
#    xmar$Years <- factor(xmar$Years, levels = c("Prior to 2000", "Since 2000"))
#    xmar$AgeGroup <- factor(xmar$AgeGroup,
#                            levels = c("15-24", "25-44", "45-64", "65+"))
#    xmar$Gender <- factor(xmar$Gender, levels = c("Male", "Female"))
#    xmar$GenderAge <- factor(xmar$GenderAge,
#                             levels = c("Male 15-24", "Male 25-44", "Male 45-64",
#                                        "Male 65+",
#                                        "Female 15-24", "Female 25-44", "Female 45-64",
#                                        "Female 65+"))
#    xmar$Opinion <- factor(xmar$Opinion, levels = c("Traditional", "Non-Traditional"))
#  
#    return(xmar)
#  }

## ----a-eda, code=readLines('../R/univariate.R')[11:104], echo=TRUE, eval=FALSE------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#  univariate <- function(xmar) {
#  
#    analyze <- function(data, var) {
#  
#      me <- 0.05
#      alpha <- 0.05
#      z <- (1-alpha/2)
#  
#      stats <- data %>%
#        mutate(Level = data[,1],
#               `Minimum N` = round(p * (1-p) / (me / qnorm(z))^2, 0),
#               N = N,
#               Proportion = round(p, 2),
#               Cumulative = round(cumsum(Proportion), 2),
#               `Confidence Interval (95%)` =
#                 paste0("[",
#                        round(Proportion -
#                                (qnorm(z) *
#                                   sqrt(Proportion * (1 - Proportion) / N)),3),
#                        ", ",
#                        round(Proportion +
#                                (qnorm(z) *
#                                   sqrt(Proportion * (1 - Proportion) / N)),3),
#                        "]"),
#               pos = N / 2)
#  
#      barplot <- ggplot2::ggplot(data = stats,
#                                 ggplot2::aes(x = Level, y = N, fill = Level)) +
#        ggplot2::geom_bar(stat='identity') + ggplot2::theme_minimal(base_size = 24) +
#        ggplot2::geom_text(
#          data = stats,
#          ggplot2::aes(x = Level, y = pos,
#                       label = paste0(N, " (",round(Proportion * 100, 0),"%)")),
#          colour="black", family="Tahoma", size = 8) +
#        ggplot2::theme(text = ggplot2::element_text(family="Open Sans"),
#                       axis.title.x = ggplot2::element_blank(),
#                       axis.ticks.x = ggplot2::element_blank(),
#                       legend.position = "none") +
#        ggplot2::scale_fill_brewer(palette = 'Greens') +
#        ggplot2::ggtitle(paste('Frequency and Proportion of Responses by', var))
#  
#      stats <- stats %>% select(Level, `Minimum N`, N, Proportion, Cumulative,
#                                `Confidence Interval (95%)`)
#  
#      analysis <- list(
#        stats = stats,
#        plot = barplot
#      )
#  
#      return(analysis)
#    }
#  
#    # Format Data
#    opinion <- as.data.frame(xmar %>% select(Opinion) %>% group_by(Opinion) %>%
#                             summarize(N = n()) %>%
#                             mutate(p = N/ sum(N)), row.names = NULL)
#  
#    years <- as.data.frame(xmar %>% select(Years) %>% group_by(Years) %>%
#                             summarize(N = n()) %>%
#                             mutate(p = N/ sum(N)), row.names = NULL)
#    age <- as.data.frame(xmar %>% select(AgeGroup) %>% group_by(AgeGroup) %>%
#                           summarize(N = n()) %>%
#                           mutate(p = N/ sum(N)), row.names = NULL)
#    gender <- as.data.frame(xmar %>% select(Gender) %>% group_by(Gender) %>%
#                              summarize(N = n()) %>%
#                              mutate(p = N/ sum(N)), row.names = NULL)
#    maleAge <- as.data.frame(xmar %>% filter(Gender == "Male") %>%
#                               group_by(GenderAge) %>%
#                               summarize(N = n()) %>%
#                               mutate(p = N/ sum(N)), row.names = NULL)
#    femaleAge <- as.data.frame(xmar %>% filter(Gender == "Female") %>%
#                               group_by(GenderAge) %>%
#                               summarize(N = n()) %>%
#                               mutate(p = N/ sum(N)), row.names = NULL)
#  
#    # Conduct Analysis
#    opinion <- analyze(opinion, "Opinion")
#    years <- analyze(years, "Years")
#    age <- analyze(age, "Age Group")
#    gender <- analyze(gender, "Gender")
#    maleAge <- analyze(maleAge, "Males and Age Group")
#    femaleAge <- analyze(femaleAge, "Females and Age Group")
#  
#    # Return analysis
#    analysis <- list(
#      opinion = opinion,
#      years = years,
#      age = age,
#      gender = gender,
#      maleAge = maleAge,
#      femaleAge = femaleAge
#      )
#    return(analysis)
#  }

## ----a-eda, code=readLines('../R/univariate.R')[11:104], echo=TRUE, eval=FALSE------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#  univariate <- function(xmar) {
#  
#    analyze <- function(data, var) {
#  
#      me <- 0.05
#      alpha <- 0.05
#      z <- (1-alpha/2)
#  
#      stats <- data %>%
#        mutate(Level = data[,1],
#               `Minimum N` = round(p * (1-p) / (me / qnorm(z))^2, 0),
#               N = N,
#               Proportion = round(p, 2),
#               Cumulative = round(cumsum(Proportion), 2),
#               `Confidence Interval (95%)` =
#                 paste0("[",
#                        round(Proportion -
#                                (qnorm(z) *
#                                   sqrt(Proportion * (1 - Proportion) / N)),3),
#                        ", ",
#                        round(Proportion +
#                                (qnorm(z) *
#                                   sqrt(Proportion * (1 - Proportion) / N)),3),
#                        "]"),
#               pos = N / 2)
#  
#      barplot <- ggplot2::ggplot(data = stats,
#                                 ggplot2::aes(x = Level, y = N, fill = Level)) +
#        ggplot2::geom_bar(stat='identity') + ggplot2::theme_minimal(base_size = 24) +
#        ggplot2::geom_text(
#          data = stats,
#          ggplot2::aes(x = Level, y = pos,
#                       label = paste0(N, " (",round(Proportion * 100, 0),"%)")),
#          colour="black", family="Tahoma", size = 8) +
#        ggplot2::theme(text = ggplot2::element_text(family="Open Sans"),
#                       axis.title.x = ggplot2::element_blank(),
#                       axis.ticks.x = ggplot2::element_blank(),
#                       legend.position = "none") +
#        ggplot2::scale_fill_brewer(palette = 'Greens') +
#        ggplot2::ggtitle(paste('Frequency and Proportion of Responses by', var))
#  
#      stats <- stats %>% select(Level, `Minimum N`, N, Proportion, Cumulative,
#                                `Confidence Interval (95%)`)
#  
#      analysis <- list(
#        stats = stats,
#        plot = barplot
#      )
#  
#      return(analysis)
#    }
#  
#    # Format Data
#    opinion <- as.data.frame(xmar %>% select(Opinion) %>% group_by(Opinion) %>%
#                             summarize(N = n()) %>%
#                             mutate(p = N/ sum(N)), row.names = NULL)
#  
#    years <- as.data.frame(xmar %>% select(Years) %>% group_by(Years) %>%
#                             summarize(N = n()) %>%
#                             mutate(p = N/ sum(N)), row.names = NULL)
#    age <- as.data.frame(xmar %>% select(AgeGroup) %>% group_by(AgeGroup) %>%
#                           summarize(N = n()) %>%
#                           mutate(p = N/ sum(N)), row.names = NULL)
#    gender <- as.data.frame(xmar %>% select(Gender) %>% group_by(Gender) %>%
#                              summarize(N = n()) %>%
#                              mutate(p = N/ sum(N)), row.names = NULL)
#    maleAge <- as.data.frame(xmar %>% filter(Gender == "Male") %>%
#                               group_by(GenderAge) %>%
#                               summarize(N = n()) %>%
#                               mutate(p = N/ sum(N)), row.names = NULL)
#    femaleAge <- as.data.frame(xmar %>% filter(Gender == "Female") %>%
#                               group_by(GenderAge) %>%
#                               summarize(N = n()) %>%
#                               mutate(p = N/ sum(N)), row.names = NULL)
#  
#    # Conduct Analysis
#    opinion <- analyze(opinion, "Opinion")
#    years <- analyze(years, "Years")
#    age <- analyze(age, "Age Group")
#    gender <- analyze(gender, "Gender")
#    maleAge <- analyze(maleAge, "Males and Age Group")
#    femaleAge <- analyze(femaleAge, "Females and Age Group")
#  
#    # Return analysis
#    analysis <- list(
#      opinion = opinion,
#      years = years,
#      age = age,
#      gender = gender,
#      maleAge = maleAge,
#      femaleAge = femaleAge
#      )
#    return(analysis)
#  }

